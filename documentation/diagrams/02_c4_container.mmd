C4Container
title "WaveTap - Container View (Current & Planned)"

Person(user, "Client Operator", "Uses dashboards and module console")

System_Ext(rtlsdr, "USB RTL-SDR", "Hardware front-end")
System_Ext(dump1090, "dump1090 Decoder", "Feeds Mode-S frames over TCP 30002")

System_Boundary(wavetap, "WaveTap Stack") {
  Container(publisher, "adsb-publisher", "Python + websockets", "Pulls dump1090 feed and publishes aircraft JSON")
  Container(subscriber, "adsb-subscriber", "Python asyncio", "Consumes WebSocket snapshots and queues DB writes")
  Container(api, "WaveTap API", "Flask + Jinja", "Serves dashboards and REST endpoints for ADS-B data")
  Container(arbiter, "Arbiter Service", "Flask", "Registers SDR modules and exposes orchestration APIs")
  ContainerDb(sqlite, "Telemetry Database", "SQLite", "Stores aircraft history and path samples")
  Container(ui, "Desktop Dashboard", "Python/Tkinter", "Optional local situational awareness client")
  Container(future_vhf, "VHF Voice Service (Planned)", "Python SDR", "Future aviation-band audio capture & transcription")
  Container(future_fm, "FM Broadcast Service (Planned)", "Python SDR", "Future FM analytics & recording")
  Container(future_am, "AM Broadcast Service (Planned)", "Python SDR", "Future AM monitoring & alerts")
}

Rel(rtlsdr, dump1090, "USB IQ samples")
Rel(dump1090, publisher, "Mode-S messages", "TCP 30002")
Rel(publisher, subscriber, "Aircraft JSON stream", "WebSocket 8443")
Rel(subscriber, sqlite, "Persist telemetry", "SQLite writes")
Rel(api, sqlite, "Query aircraft data", "SQL")
Rel(user, api, "View dashboards & endpoints", "HTTPS")
Rel(user, ui, "Launch desktop tooling")
Rel(ui, api, "Fetch summaries", "HTTP/JSON")
Rel(user, arbiter, "Manage modules", "HTTPS/JSON")
Rel(arbiter, publisher, "Activate/deactivate publisher", "Internal HTTP")
Rel(arbiter, subscriber, "Coordinate persistence", "Internal HTTP")
Rel(future_vhf, arbiter, "Planned module registration")
Rel(future_fm, arbiter, "Planned module registration")
Rel(future_am, arbiter, "Planned module registration")
Rel(future_vhf, api, "Planned dashboards & APIs")
Rel(future_fm, api, "Planned dashboards & APIs")
Rel(future_am, api, "Planned dashboards & APIs")