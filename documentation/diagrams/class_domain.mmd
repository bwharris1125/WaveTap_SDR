classDiagram
title WaveTap - Class Domain Model

class ADSBClient {
	+aircraft_data: Dict[str, Dict]
	+handle_messages(messages: List[Tuple[str, float]])
	-_update_position()
	-_annotate_distance()
}

class ADSBPublisher {
	+handler(websocket)
	+publish_data()
	+run()
	+close()
	-clients: Set
	-src_client: ADSBClient
}

ADSBPublisher *-- ADSBClient

class ADSBSubscriber {
	+setup_db(db_path: Optional[str])
	+connect_and_listen(retry_delay: float, max_retry_delay: float)
	+save_to_db()
	-db_worker: DBWorker
	-aircraft_data: Dict
}

class DBWorker {
	+enqueue(task: Tuple)
	+stop()
	+run()
	-q: Queue
	-conn: sqlite3.Connection
}

ADSBSubscriber *-- DBWorker

class AircraftState {
	+icao: str
	+callsign: Optional[str]
	+session_id: Optional[str]
	+last_seen: float
}

DBWorker ..> AircraftState : persists telemetry

class ManagedModule {
	+name: str
	+description: Optional[str]
	+start()
	+stop()
	+get_status(): Dict
	-_active: bool
	-_activated_at: datetime
}

class SDRModule {
	<<abstract>>
	+start()
	+stop()
	+get_status(): Dict
}

ManagedModule ..|> SDRModule

class Arbiter {
	+register_module(name: str, module: SDRModule)
	+switch_to(name: str)
	+get_active_status(): Optional[Dict]
	+stop_all()
	-modules: Dict[str, SDRModule]
	-active_module: Optional[str]
}

Arbiter o--> SDRModule

class ArbiterService {
	<<Flask service>>
	+register_module(name: str)
	+delete_module(name: str)
	+activate_module(name: str)
	+get_status()
	-controller: Arbiter
}

ArbiterService *-- Arbiter
ArbiterService *-- ManagedModule

class WaveTapAPI {
	<<Flask app>>
	+home()
	+vhf_dashboard()
	+fm_dashboard()
	+am_dashboard()
	+other_dashboard()
	-app: Flask
}

class ADSBBlueprint {
	<<Flask Blueprint>>
	+dashboard()
	+live_data()
	+historical_data()
	+api_aircraft(window: int)
	+api_aircraft_detail(icao: str)
	-_get_connection()
	-_filter_recent_aircraft()
}

WaveTapAPI *-- ADSBBlueprint
ADSBBlueprint ..> DBWorker : queries telemetry
