C4Deployment
title "WaveTap - C4 Deployment"


Deployment_Node(edge_host, "Edge Host", "Linux + RTL-SDR") {
    Node(rtlsdr_hw, "RTL-SDR Hardware", "USB Device") {
        System_Ext(rtlsdr, "USB RTL-SDR", "Captures RF energy")
    }
    Node(dump_srv, "Dump1090 Service", "Process") {
        Container_Ext(dump1090, "Dump1090 Decoder", "C application", "Outputs Mode-S frames via TCP 30002")
    }
    Node(future_node, "Audio Services", "Planned - TBD") {
        Container_Ext(vhf_service, "VHF Voice Pipeline", "Planned", "Future aviation-band audio capture & transcription")
        Container_Ext(broadcast_service, "FM/AM Pipelines", "Planned", "Future broadcast demodulation & analytics")
    }
    Node(sdr_cap, "SDR Capture", "Docker + Python") {
        Container(publisher, "adsb-publisher", "Python", "Publishes aircraft snapshots over WebSocket 8443")
    }
}

Deployment_Node(compose_stack, "WaveTap Compose Stack", "Linux Docker Engine") {
    Node(arb_container, "arbiter", "Docker + Flask") {
        Container(arbiter, "Arbiter Service", "Flask", "Manages SDR control and module services")
    }
    Node(api_container, "database-api", "Docker + Python") {
        Container(subscriber, "adsb-subscriber", "Python", "Consumes decoded ADS-B stream and stores telemetry")
        ContainerDb(sqlite, "Telemetry Database", "SQLite", "Stored aircraft history and tracks")
        Container(api, "WaveTap API", "Python / Flask API", "Web Dashboards, REST Endpoints")
    }
}

Deployment_Node(client_env, "Operations Workstation", "Browser + Python") {
    Node(browser, "Web Browser", "Chrome/Edge") {
        Container_Ext(ui_web, "WaveTap Web Interface", "HTML/JS", "Uses Flask endpoints at :5000")
    }
    Node(desktop_tools, "Desktop Toolkit", "Python") {
        Container(ui_tk, "Tkinter Dashboard", "Tkinter", "Optional local monitoring client")
    }
}

%% Future Development Nodes
Rel(rtlsdr, vhf_service, "IQ Stream")
Rel(rtlsdr, broadcast_service, "IQ Stream")
%% Rel(vhf_service, arbiter, "Planned module registration")
%% Rel(vhf_service, api, "Planned data publishing")

Rel(rtlsdr, dump1090, "IQ Stream")
Rel(dump1090, publisher, "Streams raw Mode-S frames", "TCP 30002")
Rel(publisher, subscriber, "Decoded ADS-B Data (JSON)", "WebSocket 8443")

Rel(subscriber, sqlite, "Writes telemetry", "SQLite")
Rel(sqlite, api, "Reads telemetry", "SQL")
Rel(api, arbiter, "Planned Control Path")
Rel(arbiter, rtlsdr, "Controls SDR configuration", "WebSocket")
%% Rel(api, sqlite, "Reads telemetry", "SQL")
%% Rel(arbiter, publisher, "Activate/stop module", "HTTP (internal)")
%% Rel(arbiter, subscriber, "Coordinate persistence cadence", "HTTP (internal)")
Rel(api, ui_web, "Dashboards & REST", "HTTPS 5000")
Rel(api, ui_tk, "Queries aircraft data", "HTTP/JSON")

%% Rel(broadcast_service, arbiter, "Planned module registration")
%% Rel(broadcast_service, api, "Planned data publishing")
